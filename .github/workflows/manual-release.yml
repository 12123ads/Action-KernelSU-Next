name: Manual Release Upload

on:
  workflow_dispatch:  # 允许手动触发

jobs:
  upload_release:
    runs-on: ubuntu-latest

    steps:
      - name: 检出代码
        uses: actions/checkout@v4

      - name: 查找符合条件的 ZIP 文件
        run: |
          mkdir -p release_files
          # 查找所有符合条件的 ZIP 文件，并且排除掉 "喵喵喵" 的文件
          find . -type f -name "AnyKernel3_KernelSU_Next_*.zip" | grep -v "喵喵喵" || true | xargs -I {} cp {} release_files/ 2>/dev/null || true
          echo "找到的 ZIP 文件："
          ls -al release_files/ || echo "没有找到符合条件的 ZIP 文件"

      - name: 创建或更新 Release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          gh release view latest || gh release create latest --title "Latest Kernel Builds" --notes "Auto-generated release"

      - name: 上传所有 ZIP 文件
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          if [ -z "$(ls -A release_files)" ]; then
            echo "没有 ZIP 文件可上传，跳过此步骤。"
          else
            # 遍历 release_files 文件夹中的所有 ZIP 文件，并上传
            for file in release_files/*.zip; do
              echo "Uploading $file..."
              gh release upload latest "$file"
            done
          fi